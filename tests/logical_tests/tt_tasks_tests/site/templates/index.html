{% extends "base.html" %}

{% block content %}
    <div class="main-panel">
        
        <div class="book-panel">
            <h3>{{ bookname }} {{volume}}</h3>  
            <iframe src="http://www.archive.org/stream/{{ bookid }}?ui=embed#mode/2up"
                    width="650px" height="650px"></iframe>
        </div>
        
        <div class="workflow-panel">
            <h3>Colabore com a transcri&ccedil;&atilde;o deste livro.</h3>
            
            <div class="workflow-inner-panel">

                <div id="tt1" class="workflow-image-panel">
                    <a href="#">
                        <img src="/static/images/classificacao-off.png"></img></a>
                </div>
                
                <div id="tt2" class="workflow-image-panel">
                    <a href="#"><img src="/static/images/selecao-off.png"></img></a>
                </div>    

                <div id="tt3" class="workflow-image-panel">
                    <a href="#"><img src="/static/images/marcacao-off.png"></img></a>
                </div>  

                <div id="tt4" class="workflow-image-panel">
                    <a href="#"><img src="/static/images/transcricao-off.png"></img></a>
                </div>

                <div id="status">
                    Status
                    <ul>
                        <li id="pages"></li>
                        <li id="tables"></li>
                        <li id="transcribed"></li>
                    </ul>
                </div>

            </div>
        </div>
    </div>
<script type="text/javascript">
        $ = jQuery;
        $(window).load(function(){
            checkTasks();
                });
        
function checkTasks(){
    var tt1 = JSON.parse('{{ tt1|safe }}');
    var tt2 = JSON.parse('{{ tt2|safe }}');
    var tt3 = JSON.parse('{{ tt3|safe }}');
    var tt4 = JSON.parse('{{ tt4|safe }}');
    var tt1_url = "{{tt1_url}}";
    var tt2_url = "{{tt2_url}}";
    var tt3_url = "{{tt3_url}}";
    var tt4_url = "{{tt4_url}}";

    if(tt1.length > 0){
        $("#tt1 > a").attr("href",tt1_url);
        $("#tt1 > a > img").attr("src","/static/images/classificacao.png");
    }    
    if(tt2.length > 0){
        $("#tt2 > a").attr("href",tt2_url);
        $("#tt2 > a > img").attr("src","/static/images/selecao.png");
    }
    if(tt3.length > 0){
        $("#tt3 > a").attr("href",tt3_url);
        $("#tt3 > a > img").attr("src","/static/images/marcacao.png");
    }
    if(tt4.length > 0){
        $("#tt4 > a").attr("href",tt4_url);
        $("#tt4 > a > img").attr("src","/static/images/transcricao.png");
    }
    
    //TODO: Try to improve this later.
    var checked = known = qtd = transcribed = 0;
    for(i = 0; i < tt1.length; i++){
        qtd++;
        if(tt1[i].state == "completed"){
            checked++;
        }
    }

    for(i = 0; i < tt2.length; i++){
        known++;
    }

    for(i = 0; i < tt4.length; i++){
        if(tt4[i].state == "completed"){
            transcribed++;
        }
    }


    $("#pages").text("pÃ¡ginas avaliadas: " + checked + "/" + qtd);
    $("#tables").text("tabelas conhecidas: " + known);
    $("#transcribed").text("tabelas transcritas: " + transcribed + "/" + known);


}

    
</script>
{% endblock %}

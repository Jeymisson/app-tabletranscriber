{% extends "base.html" %}

{% block content %}
    <div class="main-panel">
        
        <div class="book-panel">
            <iframe src="http://www.archive.org/stream/{{ bookid }}?ui=embed#mode/2up"
                    width="650px" height="650px"></iframe>
        </div>
        
        <div class="workflow-panel">
            <h3>Colabore com a transcri&ccedil;&atilde;o deste livro.</h3>
            
            <div class="workflow-inner-panel">

                <div id="tt1" class="workflow-image-panel">
                    <a href="#">
                        <img src="/tt/static/images/classificacao-off.png"></img></a>
                </div>
                
                <div id="tt2" class="workflow-image-panel">
                    <a href="#"><img src="/tt/static/images/selecao-off.png"></img></a>
                </div>    

                <div id="tt3" class="workflow-image-panel">
                    <a href="#"><img src="/tt/static/images/marcacao-off.png"></img></a>
                </div>  

                <div id="tt4" class="workflow-image-panel">
                    <a href="#"><img src="/tt/static/images/transcricao-off.png"></img></a>
                </div>

                <div id="status">
                    Status
                    <ul>
                        <li id="pages"></li>
                        <li id="tables"></li>
                        <li id="transcribed"></li>
                    </ul>
                </div>

            </div>
        </div>
    </div>
<script type="text/javascript">
        $ = jQuery;
        $(window).load(function(){
            checkTasks();
                });
        
function checkTasks(){
    var tasks = JSON.parse('{{ tasks|safe }}');
    console.log(tasks);
    for (i = 0; i < tasks.length; i++){
        if(tasks[i][1].length > 0){
            $("#tt" + (i+1) + " > a").attr("href", tasks[i][2]);
            $("#tt" + (i+1) + " > a > img").attr("src","/tt/static/images/classificacao.png");
        }
    }
    
    //TODO: Try to improve this later.
    var checked = known = qtd = transcribed = 0;
    for(i = 0; i < tasks[0][1].length; i++){
        qtd++;
        if(tasks[0][1][i].state == "completed"){
            checked++;
        }
    }

    for(i = 0; i < tasks[1][1].length; i++){
        known++;
    }

    for(i = 0; i < tt4.length; i++){
        if(tt4[i].state == "completed"){
            transcribed++;
        }
    }


    $("#pages").text("pÃ¡ginas avaliadas: " + checked + "/" + qtd);
    $("#tables").text("tabelas conhecidas: " + known);
    $("#transcribed").text("tabelas transcritas: " + transcribed + "/" + known);


}

    
</script>
{% endblock %}

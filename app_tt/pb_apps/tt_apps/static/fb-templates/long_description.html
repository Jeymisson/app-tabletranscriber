<div id="mb" style="display: none"></div>
<div id="books" style="display: none"></div>

<script>
	var bookId;
	
	function loadAHTML(targetEl, htmlUrl, callback) {
		$("#loading-container").show();
		$(targetEl).load(htmlUrl, function(){
			$("#loading-container").hide();
			callback();
		});
	}

	loadAHTML('#mb', "https://" + server_name + "/mb", function() {
		$("#mb .navbar").hide();
		$('#footer_links').hide();

		$('#mb').show();
		$('#mb .btn .btn-success').click(handleStartContributingClickEvent);
		$(".container-wrapper a").click(handleStartContributingClickEvent);
	});

	function clearMBInterface() {
		$('body').off('mouseup');
		$('body').off('mousedown');
		$('body').off('contextmenu');
		$("[rel=tooltip]").tooltip('destroy');
		$("[rel=popover]").popover('destroy');
	}
	
	function handleStartContributingClickEvent(e) {
		e.preventDefault();
		initFacebookLogin();
		loadBooksPage("/mb/collaborate");
	}

	function setUpBooksPage() {
		$('#books #footer_links').hide();
		$("#books .navbar").hide();

		$("#task-long-description").show();
		$('#books').show();
	}

	function loadBooksPage(url) {
		clearMBInterface();
		
		$('#mb').hide();
		$('#books').hide();
		$("#task-template").hide();

		loadAHTML('#books', "https://" + server_name + url, function() {
			setUpBooksPage();

			$(".container-wrapper a").click(function(e) {
				e.preventDefault();

				var addressValue = $(this).attr("href");

				if (addressValue == "#")
					return;

				if (addressValue.indexOf("collaborate") != -1) {
					loadBooksPage(addressValue);
					return;
				}

				var POSITION_BOOK_ID = 5;
				var tmp = addressValue.split("/")[POSITION_BOOK_ID];
				bookId = tmp.substring(0, tmp.indexOf("_"));

				$("#task-template").load("template.html", function() {
					showTaskTemplate();
				});
			});
		});
	}
</script>